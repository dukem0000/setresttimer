<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Set Rest Timer</title>

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Rest Timer" />
<meta name="theme-color" content="#0b1220" />

<style>
:root {
  --bg1: radial-gradient(1200px 800px at 20% -10%, rgba(125,211,252,0.2), transparent);
  --bg2: radial-gradient(1000px 600px at 120% 110%, rgba(52,211,153,0.15), transparent);
  --card: rgba(255,255,255,0.10);
  --text: rgba(255,255,255,0.92);
  --ring-neutral: rgba(255,255,255,0.45);
  --ring-active: #f59e0b;
  --ring-done:   #34d399;
}

* { box-sizing: border-box }
html, body {
  height: 100%; margin: 0;
  font-family: ui-rounded, -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  color: var(--text);
  background: var(--bg1), var(--bg2), #0b1220;
  -webkit-font-smoothing: antialiased;
  user-select: none;
}
.page {
  min-height: 100%;
  display: grid;
  place-items: center;
  padding: calc(24px + env(safe-area-inset-top)) 24px calc(24px + env(safe-area-inset-bottom));
}
.card {
  width: 100%;
  max-width: 420px;
  background: var(--card);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 22px;
  backdrop-filter: blur(18px);
  box-shadow: 0 10px 40px -12px rgba(0,0,0,.45);
  padding: 20px 22px 18px;
  transition: all 0.4s ease;
}

/* Ring wrap */
.ringWrap { position: relative; width: 240px; height: 240px; margin: 8px auto 8px; }
.ringWrap > svg { position: relative; z-index: 0; }

/* Timer text */
.time {
  position:absolute; inset:0; display:grid; place-items:center;
  font-size: 56px; font-weight: 400; letter-spacing: .5px; font-variant-numeric: tabular-nums;
  z-index: 2;
  transition: opacity .35s ease;
}
.time.hidden { display:none; }

/* Dust effect overlay */
.dustLayer {
  position:absolute; inset:0; display:grid; place-items:center; z-index: 3; pointer-events:none;
  font-size: 56px; font-weight: 400; letter-spacing: .5px; font-variant-numeric: tabular-nums;
}
.dustChar {
  display:inline-block;
  will-change: transform, opacity, filter;
  animation: blow 800ms ease-out forwards;
}
@keyframes blow {
  0%   { transform: translate(0,0) rotate(0deg); opacity:1; filter: blur(0px); }
  60%  { filter: blur(1.5px); }
  100% { transform: translate(var(--dx,-18px), var(--dy,-18px)) rotate(var(--rot,10deg)); opacity:0; filter: blur(3px); }
}

/* Breathing animation */
.breath {
  position:absolute; inset:0; display:grid; place-items:center; pointer-events:none; z-index: 1;
  opacity: .35; transform: scale(1); transition: opacity .25s ease, transform .25s ease;
}
.breath.focus { opacity: 1; transform: scale(1.05); }
.breath-dot {
  width: 78px; height: 78px; border-radius: 50%;
  background: rgba(255,255,255,0.10);
  border: 2px solid rgba(255,255,255,0.85);
  box-shadow: 0 0 18px rgba(255,255,255,0.25), inset 0 0 8px rgba(255,255,255,0.12);
}

/* Whisper text now fixed at bottom center */
.whisper {
  position:absolute; bottom: 18px; left:0; right:0;
  display:flex; justify-content:center;
  font-size: 13px; letter-spacing:.08em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.85);
  pointer-events:none;
}
.whisper span { position:absolute; opacity:0; }

/* Eye toggle row */
.eye-row { display:flex; justify-content:center; align-items:center; margin: 6px 0 8px; }
.eye-btn {
  width: 36px; height: 36px; border-radius: 50%;
  display:flex; align-items:center; justify-content:center;
  border: 1px solid rgba(255,255,255,.22);
  background: rgba(255,255,255,0.10);
  backdrop-filter: blur(10px);
  cursor:pointer;
  opacity: .85;
}
.eye-icon { width: 20px; height: 20px; }

/* Presets */
.grid3 { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; margin-top: 6px; }
.btn {
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.22);
  background: rgba(255,255,255,.10);
  color: var(--text);
  padding: 12px 14px;
  text-align: center;
  font-weight: 650;
  backdrop-filter: blur(12px);
}

/* Controls */
.controls {
  display: flex;
  justify-content: center;
  gap: 18px;
  align-items: center;
  margin-top: 12px;
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  transform: translateY(-8px);
  transition: max-height 0.4s ease, opacity 0.3s ease, transform 0.3s ease;
}
.controls.show { max-height: 80px; opacity: 1; transform: translateY(0); }

.circle-btn {
  width: 54px; height: 54px; border-radius: 50%;
  display:flex; align-items:center; justify-content:center;
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.22);
  backdrop-filter: blur(12px);
}
.icon { width: 26px; height: 26px; }
.icon-reset { width: 26px; height: 26px; }

/* Bottom buttons */
.bottomButtons { margin-top: 18px; display: flex; justify-content: center; gap: 18px; }
.whoop-btn { font-size: 26px; font-weight: 800; color: var(--text); }
.notes-icon {
  width: 28px; height: 28px;
  border-radius: 4px;
  border: 2px solid rgba(255,255,255,0.9);
  position: relative;
}
.notes-icon::before,
.notes-icon::after {
  content: '';
  position: absolute; left: 4px; right: 4px; height: 2px;
  background: rgba(255,255,255,0.9);
  border-radius: 1px;
}
.notes-icon::before { top: 6px; }
.notes-icon::after { top: 12px; }
</style>
</head>
<body>
<div class="page">
  <div class="card" id="card">
    <div class="ringWrap" id="ringWrap">
      <svg width="240" height="240">
        <circle cx="120" cy="120" r="110" stroke="rgba(255,255,255,.12)" stroke-width="10" fill="none"/>
        <circle id="ringProg" cx="120" cy="120" r="110" stroke="var(--ring-neutral)" stroke-width="10" fill="none"
          stroke-linecap="round" transform="rotate(-90 120 120)" style="stroke-dasharray: 0 691"/>
      </svg>

      <div class="breath" id="breath">
        <div class="breath-dot" id="breathDot"></div>
        <div class="whisper" id="whisper">
          <span id="phaseText"></span>
        </div>
      </div>

      <div class="time" id="time">0:00</div>
    </div>

    <div class="eye-row">
      <button id="eyeBtn" class="eye-btn">
        <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
          <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
      </button>
    </div>

    <div class="grid3">
      <button class="btn" id="btn-60">1:00</button>
      <button class="btn" id="btn-90">1:30</button>
      <button class="btn" id="btn-120">2:00</button>
    </div>

    <div class="controls" id="controls">
      <button class="circle-btn" id="pauseResume">
        <svg id="pauseIcon" class="icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
          <rect x="6.5" y="5" width="3.5" height="14" rx="1.2"></rect>
          <rect x="14" y="5" width="3.5" height="14" rx="1.2"></rect>
        </svg>
        <svg id="playIcon" class="icon" viewBox="0 0 24 24" fill="white" style="display:none">
          <path d="M6 4l14 8-14 8z"></path>
        </svg>
      </button>

      <button class="circle-btn" id="reset">
        <svg class="icon-reset" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
          <path d="M3 12a9 9 0 1 0 3-6.7"></path>
          <path d="M3 4v6h6"></path>
        </svg>
      </button>
    </div>

    <div class="bottomButtons">
      <button class="circle-btn whoop-btn" id="whoopBtn">W</button>
      <button class="circle-btn" id="notesBtn"><div class="notes-icon"></div></button>
    </div>
  </div>
</div>

<script>
let duration=0, remaining=0, running=false, completed=false, endTime=null, rafId=null;
let showTime=true, breathingStarted=false, phaseIndex=0, phaseTimer=null;
const phases=["In","Hold","Out","Hold"];

const timeEl=document.getElementById('time');
const ringProg=document.getElementById('ringProg');
const breathEl=document.getElementById('breath');
const phaseText=document.getElementById('phaseText');
const pauseIcon=document.getElementById('pauseIcon');
const playIcon=document.getElementById('playIcon');
const controlsEl=document.getElementById('controls');
const RADIUS=110, CIRC=2*Math.PI*RADIUS;

function setRingColor(c){ ringProg.setAttribute('stroke',c); }
function fmt(s){ return `${Math.floor(s/60)}:${String(Math.floor(s%60)).padStart(2,'0')}`; }

function updateUI(){
  timeEl.classList.toggle('hidden',!showTime);
  breathEl.classList.toggle('focus',!showTime);
}

function blowAwayText(str){
  const layer=document.createElement('div');
  layer.className='dustLayer';
  for(const ch of str){
    const span=document.createElement('span');
    span.className='dustChar';
    span.textContent=ch;
    const dx= - (Math.random()*60 + 14); // blow left
    const dy= - (Math.random()*40 + 8);
    const rot=(Math.random()*40 - 20);
    span.style.setProperty('--dx',dx+'px');
    span.style.setProperty('--dy',dy+'px');
    span.style.setProperty('--rot',rot+'deg');
    layer.appendChild(span);
  }
  document.getElementById('ringWrap').appendChild(layer);
  setTimeout(()=>layer.remove(),900);
}

function rafTick(){
  const now=Date.now(), remMs=endTime-now, remSec=Math.max(0, remMs/1000);
  ringProg.style.strokeDasharray=(CIRC*((duration-remSec)/duration))+' '+CIRC;
  remaining=Math.ceil(remSec);
  timeEl.textContent=fmt(remaining);
  if(remMs<=0){
    cancelAnimationFrame(rafId); running=false; completed=true;
    remaining=0; timeEl.textContent=fmt(0);
    setRingColor(getComputedStyle(document.documentElement).getPropertyValue('--ring-done').trim());
    return;
  }
  rafId=requestAnimationFrame(rafTick);
}

function startWith(s){
  duration=s; remaining=s; completed=false; running=true;
  endTime=Date.now()+s*1000;
  setRingColor(getComputedStyle(document.documentElement).getPropertyValue('--ring-active').trim());
  document.getElementById('controls').classList.add('show');
  updateUI();
  if(!breathingStarted){ startBreathing(); breathingStarted=true; }
  rafId=requestAnimationFrame(rafTick);
}

function startBreathing(){
  phaseText.textContent=phases[0]; phaseIndex=0;
  phaseTimer=setInterval(()=>{
    phaseIndex=(phaseIndex+1)%phases.length;
    phaseText.textContent=phases[phaseIndex];
  },4000);
  document.getElementById('breathDot').style.animation='breatheBox 16s ease-in-out infinite';
}

function pauseResume(){
  if(completed) return;
  if(running){
    running=false; cancelAnimationFrame(rafId);
  } else {
    running=true; endTime=Date.now()+(remaining*1000);
    rafId=requestAnimationFrame(rafTick);
  }
}

function reset(){
  cancelAnimationFrame(rafId);
  running=false; completed=false; duration=0; remaining=0;
  setRingColor(getComputedStyle(document.documentElement).getPropertyValue('--ring-neutral').trim());
  document.getElementById('controls').classList.remove('show');
  timeEl.textContent='0:00';
}

document.getElementById('eyeBtn').addEventListener('click',()=>{
  if(showTime){
    const cur=timeEl.textContent;
    timeEl.style.opacity=0;
    blowAwayText(cur);
    setTimeout(()=>{ showTime=false; timeEl.classList.add('hidden'); timeEl.style.opacity=''; updateUI(); },120);
  } else {
    showTime=true; timeEl.classList.remove('hidden'); timeEl.style.opacity=0; updateUI();
    requestAnimationFrame(()=> requestAnimationFrame(()=> timeEl.style.opacity=1));
    setTimeout(()=> timeEl.style.opacity='',400);
  }
});

document.getElementById('btn-60').onclick=()=>startWith(60);
document.getElementById('btn-90').onclick=()=>startWith(90);
document.getElementById('btn-120').onclick=()=>startWith(120);
document.getElementById('pauseResume').onclick=pauseResume;
document.getElementById('reset').onclick=reset;
document.getElementById('whoopBtn').onclick=()=>window.location='whoop://';
document.getElementById('notesBtn').onclick=()=>window.location='mobilenotes://';

setRingColor(getComputedStyle(document.documentElement).getPropertyValue('--ring-neutral').trim());
updateUI();
</script>
</body>
</html>
