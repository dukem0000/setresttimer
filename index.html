<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Set Rest Timer</title>

<!-- iOS web app feel -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Rest Timer" />
<meta name="theme-color" content="#0b1220" />

<style>
:root {
  --bg1: radial-gradient(1200px 800px at 20% -10%, rgba(125,211,252,0.2), transparent);
  --bg2: radial-gradient(1000px 600px at 120% 110%, rgba(52,211,153,0.15), transparent);
  --card: rgba(255,255,255,0.10);
  --text: rgba(255,255,255,0.92);
  --ring-neutral: rgba(255,255,255,0.45);  /* idle */
  --ring-active: #f59e0b;                  /* orange while running */
  --ring-done:   #34d399;                  /* green when finished */
}

* { box-sizing: border-box }
html, body {
  height: 100%; margin: 0;
  font-family: ui-rounded, -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  color: var(--text);
  background: var(--bg1), var(--bg2), #0b1220;
  -webkit-font-smoothing: antialiased;
  user-select: none;
  overscroll-behavior: none;
}
.page {
  min-height: 100%;
  display: grid;
  place-items: center;
  padding: calc(24px + env(safe-area-inset-top)) 24px calc(24px + env(safe-area-inset-bottom));
}
.card {
  width: 100%;
  max-width: 420px;
  background: var(--card);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 22px;
  backdrop-filter: blur(18px);
  box-shadow: 0 10px 40px -12px rgba(0,0,0,.45);
  padding: 22px 22px 18px;
  transition: all 0.4s ease;
}
.title { font-size: 20px; font-weight: 700; text-align: center; margin-bottom: 6px; }

.ringWrap { position: relative; width: 240px; height: 240px; margin: 14px auto 8px; }
.time {
  position:absolute; inset:0; display:grid; place-items:center;
  font-size: 56px; font-weight: 400; letter-spacing: .5px; font-variant-numeric: tabular-nums;
  text-shadow: 0 1px 0 rgba(0,0,0,.2);
}
.time.hidden { display:none; }

/* Eye toggle under ring */
.eye-row { display:flex; justify-content:center; align-items:center; margin-bottom: 8px; }
.eye-btn {
  width: 36px; height: 36px; border-radius: 50%;
  display:flex; align-items:center; justify-content:center;
  border: 1px solid rgba(255,255,255,.22);
  background: rgba(255,255,255,0.10);
  backdrop-filter: blur(10px);
  cursor:pointer;
  transition: background .15s ease, transform .04s ease, opacity .15s ease;
  opacity: .6;
}
.eye-btn:hover { background: rgba(255,255,255,0.14); }
.eye-btn:active { transform: scale(0.96); }
.eye-btn.active { opacity: 1; }
.eye-icon { width: 20px; height: 20px; display:block; }

/* Preset buttons */
.grid3 { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; margin-top: 6px; }
.btn {
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.22);
  background: rgba(255,255,255,.10);
  color: var(--text);
  padding: 12px 14px;
  text-align: center;
  font-weight: 650;
  backdrop-filter: blur(12px);
  transition: transform .04s ease, background .15s ease, border-color .15s ease;
  cursor: pointer;
}
.btn:hover   { background: rgba(255,255,255,.14); }
.btn:active  { transform: scale(.99); }
.btn[disabled]{ opacity:.6; cursor:not-allowed }
.btn-emerald { background: rgba(52,211,153,.18); border-color: rgba(52,211,153,.35); }
.btn-emerald:hover { background: rgba(52,211,153,.26); }

/* Controls slide-in */
.controls {
  display: flex;
  justify-content: center;
  gap: 18px;
  align-items: center;
  margin-top: 12px;
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  transform: translateY(-8px);
  transition: max-height 0.4s ease, opacity 0.3s ease, transform 0.3s ease;
}
.controls.show { max-height: 80px; opacity: 1; transform: translateY(0); }

/* Circular buttons */
.circle-btn {
  width: 54px; height: 54px; border-radius: 50%;
  display:flex; align-items:center; justify-content:center;
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.22);
  backdrop-filter: blur(12px);
  cursor: pointer;
  transition: background .15s ease, transform .04s ease;
}
.circle-btn:hover { background: rgba(255,255,255,0.2); }
.circle-btn:active { transform: scale(0.96); }

/* Icons in circular buttons use SVG so they stay perfectly centered */
.icon { width: 26px; height: 26px; display:block; }
.icon-reset { width: 26px; height: 26px; }

/* Controls styling (slightly more subtle) */
.controls .circle-btn { opacity: 0.8; }
.controls .circle-btn.btn-emerald { background: rgba(52,211,153,.15); border-color: rgba(52,211,153,.3); }

/* Bottom Whoop / Notes */
.bottomButtons { margin-top: 18px; display: flex; justify-content: center; gap: 18px; }
.whoop-btn { font-size: 26px; font-weight: 800; color: var(--text); } /* Bigger W again */
.notes-icon {
  width: 28px; height: 28px;
  border-radius: 4px;
  border: 2px solid rgba(255,255,255,0.9);
  position: relative;
}
.notes-icon::before,
.notes-icon::after {
  content: '';
  position: absolute; left: 4px; right: 4px; height: 2px;
  background: rgba(255,255,255,0.9);
  border-radius: 1px;
}
.notes-icon::before { top: 6px; }
.notes-icon::after { top: 12px; }

.sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
</style>
</head>
<body>
<div class="page">
  <div class="card" id="card">
    <div class="title">Set Rest Timer</div>

    <div class="ringWrap">
      <svg width="240" height="240" aria-hidden="true">
        <circle cx="120" cy="120" r="110" stroke="rgba(255,255,255,.12)" stroke-width="10" fill="none"/>
        <circle id="ringProg" cx="120" cy="120" r="110" stroke="var(--ring-neutral)" stroke-width="10" fill="none"
                stroke-linecap="round" transform="rotate(-90 120 120)" style="stroke-dasharray: 0 691"/>
      </svg>
      <div class="time" id="time">0:00</div>
    </div>

    <!-- Eye toggle -->
    <div class="eye-row">
      <button id="eyeBtn" class="eye-btn" aria-label="Show or hide timer">
        <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
      </button>
    </div>

    <div class="grid3">
      <button class="btn" id="btn-60">1:00</button>
      <button class="btn" id="btn-90">1:30</button>
      <button class="btn" id="btn-120">2:00</button>
    </div>

    <div class="controls" id="controls">
      <!-- Pause / Play -->
      <button class="circle-btn btn-emerald" id="pauseResume" aria-label="Pause or resume">
        <svg id="pauseIcon" class="icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="6.5" y="5" width="3.5" height="14" rx="1.2"></rect>
          <rect x="14" y="5" width="3.5" height="14" rx="1.2"></rect>
        </svg>
        <svg id="playIcon" class="icon" viewBox="0 0 24 24" fill="white" stroke="none" style="display:none" aria-hidden="true">
          <path d="M6 4l14 8-14 8z"></path>
        </svg>
      </button>

      <!-- Reset -->
      <button class="circle-btn" id="reset" aria-label="Reset">
        <svg class="icon-reset" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M3 12a9 9 0 1 0 3-6.7"></path>
          <path d="M3 4v6h6"></path>
        </svg>
      </button>
    </div>

    <div class="bottomButtons">
      <button class="circle-btn whoop-btn" id="whoopBtn" aria-label="Open Whoop">W</button>
      <button class="circle-btn" id="notesBtn" aria-label="Open Notes"><div class="notes-icon"></div></button>
    </div>

    <div class="sr-only" aria-live="polite" aria-atomic="true" id="live"></div>
  </div>
</div>

<script>
let duration=0, remaining=0, running=false, completed=false;
let endTime=null, wakeLock=null, rafId=null, lastShownWhole=null;
let showTime=true;

const timeEl=document.getElementById('time');
const ringProg=document.getElementById('ringProg');
const controlsEl=document.getElementById('controls');
const pauseResumeBtn=document.getElementById('pauseResume');
const pauseIcon=document.getElementById('pauseIcon');
const playIcon=document.getElementById('playIcon');
const resetBtn=document.getElementById('reset');
const eyeBtn=document.getElementById('eyeBtn');
const liveEl=document.getElementById('live');

const RADIUS=110;
const CIRC=2*Math.PI*RADIUS;
const fmt=s=>`${Math.floor(s/60)}:${String(Math.floor(s%60)).padStart(2,'0')}`;
const clamp01=x=>Math.max(0,Math.min(1,x));

function setRingColor(color){ ringProg.setAttribute('stroke', color); }

function updateUI(){
  // time visibility + eye state
  timeEl.classList.toggle('hidden', !showTime);
  eyeBtn.classList.toggle('active', !showTime);

  // progress & icons
  const progress=duration>0?(duration-remaining)/duration:0;
  ringProg.style.strokeDasharray=(CIRC*progress)+' '+CIRC;
  if(running){ pauseIcon.style.display='block'; playIcon.style.display='none'; }
  else       { pauseIcon.style.display='none';  playIcon.style.display='block'; }

  timeEl.textContent=fmt(remaining);
}

function cancelRAF(){if(rafId){cancelAnimationFrame(rafId); rafId=null;}}
async function requestWakeLock(){ try{ if('wakeLock' in navigator){ wakeLock=await navigator.wakeLock.request('screen'); } }catch(e){} }
function releaseWakeLock(){ try{ if(wakeLock){ wakeLock.release(); wakeLock=null; } }catch(e){} }
document.addEventListener('visibilitychange',()=>{ if(document.visibilityState==='visible'&&running) requestWakeLock(); });

function showControls(){ controlsEl.classList.add('show'); }
function hideControls(){ controlsEl.classList.remove('show'); }

function rafTick(){
  const now=Date.now();
  const remainingMs=endTime-now;
  const remainingSec=Math.max(0,remainingMs/1000);
  const progress=duration>0?clamp01((duration-remainingSec)/duration):0;
  ringProg.style.strokeDasharray=(CIRC*progress)+' '+CIRC;

  const whole=Math.ceil(remainingSec);
  if(whole!==lastShownWhole){
    lastShownWhole=whole; remaining=whole;
    timeEl.textContent=fmt(remaining);
  }
  if(remainingMs<=0){
    cancelRAF(); running=false; completed=true;
    remaining=0; lastShownWhole=0;
    timeEl.textContent=fmt(0);
    liveEl.textContent='Time up';
    setRingColor(getComputedStyle(document.documentElement).getPropertyValue('--ring-done').trim() || '#34d399');
    beep(); releaseWakeLock(); updateUI();
    return;
  }
  rafId=requestAnimationFrame(rafTick);
}

function startWith(s){
  cancelRAF(); hideControls();
  duration=s; remaining=s; completed=false; running=true;
  endTime=Date.now()+s*1000; lastShownWhole=Math.ceil(s);
  setRingColor(getComputedStyle(document.documentElement).getPropertyValue('--ring-active').trim() || '#f59e0b');
  liveEl.textContent=''; updateUI(); showControls();
  rafId=requestAnimationFrame(rafTick); requestWakeLock();
}
function pauseResume(){
  if(completed) return;
  if(running){ running=false; cancelRAF(); releaseWakeLock(); }
  else { running=true; endTime=Date.now()+(remaining*1000); lastShownWhole=remaining; rafId=requestAnimationFrame(rafTick); requestWakeLock(); }
  updateUI();
}
function reset(){
  cancelRAF(); hideControls();
  duration=0; remaining=0; running=false; completed=false;
  lastShownWhole=null; liveEl.textContent='';
  setRingColor(getComputedStyle(document.documentElement).getPropertyValue('--ring-neutral').trim() || 'rgba(255,255,255,0.45)');
  releaseWakeLock(); updateUI();
}

function beep(){
  try{
    const ctx=new(window.AudioContext||window.webkitAudioContext)();
    const o=ctx.createOscillator(); const g=ctx.createGain();
    o.type='sine'; o.frequency.value=880;
    o.connect(g); g.connect(ctx.destination);
    g.gain.setValueAtTime(0.0001,ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.2,ctx.currentTime+0.01);
    g.gain.exponentialRampToValueAtTime(0.0001,ctx.currentTime+0.35);
    o.start(); o.stop(ctx.currentTime+0.4);
  }catch(e){}
}

// Preset buttons
document.getElementById('btn-60').addEventListener('click',()=>startWith(60));
document.getElementById('btn-90').addEventListener('click',()=>startWith(90));
document.getElementById('btn-120').addEventListener('click',()=>startWith(120));

// Controls
pauseResumeBtn.addEventListener('click',pauseResume);
resetBtn.addEventListener('click',reset);

// Eye toggle
document.getElementById('eyeBtn').addEventListener('click', ()=>{ showTime=!showTime; updateUI(); });

// External app buttons (with haptic)
document.getElementById('whoopBtn').addEventListener('click',()=>{
  if(navigator.vibrate) navigator.vibrate(30);
  window.location='whoop://';
});
document.getElementById('notesBtn').addEventListener('click',()=>{
  if(navigator.vibrate) navigator.vibrate(30);
  window.location='mobilenotes://';
});

// Initialize ring to neutral
setRingColor(getComputedStyle(document.documentElement).getPropertyValue('--ring-neutral').trim() || 'rgba(255,255,255,0.45)');
updateUI();
</script>
</body>
</html>
